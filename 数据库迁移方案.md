# 💾 数据库迁移方案 - SQLite 到云数据库

## 为什么需要迁移？

Vercel 是**无服务器**环境：
- ❌ 不能使用 SQLite 文件数据库
- ❌ 每次部署都会重置文件系统
- ✅ 需要使用云数据库服务

## 推荐方案

### 方案一：Vercel Postgres（最简单）⭐

**优势**：
- 与 Vercel 深度集成
- 自动配置环境变量
- 免费额度充足（60 小时计算时间/月）

**步骤**：

1. **在 Vercel 添加数据库**
   ```
   Vercel Dashboard → 你的项目 → Storage → Create Database → Postgres
   ```

2. **安装 Postgres 客户端**
   ```bash
   npm install @vercel/postgres
   ```

3. **修改数据库连接**（示例）
   ```typescript
   // lib/db.ts
   import { sql } from '@vercel/postgres';

   // 替换 SQLite 查询为 Postgres 查询
   export async function getContents() {
     const { rows } = await sql`SELECT * FROM generated_contents`;
     return rows;
   }
   ```

4. **运行数据迁移**
   - 在 Vercel Dashboard 的 SQL Editor 中执行建表语句

### 方案二：Supabase（功能最全）⭐

**优势**：
- 完全免费（500MB 数据库，无限 API 请求）
- 提供实时数据库、存储、认证
- 自带管理后台

**步骤**：

1. **创建 Supabase 项目**
   - 访问：https://supabase.com
   - 创建新项目
   - 获取数据库连接信息

2. **安装 Supabase 客户端**
   ```bash
   npm install @supabase/supabase-js
   ```

3. **配置环境变量**
   ```env
   NEXT_PUBLIC_SUPABASE_URL=your-project-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```

4. **初始化 Supabase**
   ```typescript
   // lib/supabase.ts
   import { createClient } from '@supabase/supabase-js'

   export const supabase = createClient(
     process.env.NEXT_PUBLIC_SUPABASE_URL!,
     process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
   )
   ```

### 方案三：PlanetScale（高性能）

**优势**：
- MySQL 兼容
- 无服务器架构
- 免费 5GB 存储

**步骤**：

1. **创建 PlanetScale 数据库**
   - 访问：https://planetscale.com
   - 创建数据库

2. **安装客户端**
   ```bash
   npm install @planetscale/database
   ```

## 数据迁移工具

### 导出现有 SQLite 数据

```bash
# 导出为 SQL
sqlite3 data/content-factory.db .dump > backup.sql

# 导出为 CSV
sqlite3 -header -csv data/content-factory.db "SELECT * FROM generated_contents;" > contents.csv
```

### 导入到新数据库

**Postgres/Supabase**：
```sql
-- 在 SQL Editor 中执行
\i backup.sql
```

**手动导入**：
- 使用数据库管理工具（DBeaver、TablePlus）
- 从 CSV 导入

## 最小化改动方案

如果不想大改代码，可以使用 **Prisma ORM**：

```bash
npm install prisma @prisma/client
npx prisma init
```

Prisma 可以：
- 统一不同数据库的访问方式
- 自动生成类型安全的查询
- 简化数据迁移

## 快速对比

| 方案 | 免费额度 | 易用性 | 性能 | 推荐度 |
|------|---------|--------|------|--------|
| Vercel Postgres | 60h/月 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Supabase | 500MB | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| PlanetScale | 5GB | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

## 推荐迁移顺序

1. **第一阶段**：先部署到 Vercel（不迁移数据库）
   - 测试部署流程
   - 验证应用功能

2. **第二阶段**：选择数据库方案
   - 根据需求选择 Vercel Postgres 或 Supabase

3. **第三阶段**：迁移数据
   - 导出现有数据
   - 在新数据库中重建表结构
   - 导入数据

4. **第四阶段**：更新代码
   - 修改数据库连接
   - 测试所有功能
   - 部署更新

## 临时方案（快速上线）

如果需要快速部署，可以：

1. **先用无数据库版本部署**
   - 注释掉数据库相关功能
   - 只展示 UI

2. **后续添加数据库**
   - 选择云数据库
   - 逐步迁移功能

## 需要帮助？

- Vercel Postgres 文档：https://vercel.com/docs/storage/vercel-postgres
- Supabase 文档：https://supabase.com/docs
- Prisma 文档：https://www.prisma.io/docs

---

💡 **建议**：先用 Vercel Postgres 快速上线，如果后续需要更多功能再考虑 Supabase。
